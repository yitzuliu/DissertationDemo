<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯æ—¥èªŒè¨˜éŒ„æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 2px;
        }
        .log-eyes-capture { background-color: #e3f2fd; }
        .log-eyes-prompt { background-color: #f3e5f5; }
        .log-eyes-transfer { background-color: #e8f5e8; }
        .log-user-action { background-color: #fff3e0; }
        .log-error { background-color: #ffebee; }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å‰ç«¯è¦–è¦ºæ—¥èªŒè¨˜éŒ„ç³»çµ±æ¸¬è©¦</h1>
        <p>é€™å€‹é é¢ç”¨æ–¼æ¸¬è©¦å‰ç«¯è¦–è¦ºæ—¥èªŒè¨˜éŒ„åŠŸèƒ½ï¼ŒåŒ…æ‹¬åœ–åƒæ•ç²ã€è¦–è¦ºæç¤ºè©å’Œå¾Œç«¯å‚³è¼¸æ—¥èªŒã€‚</p>
        
        <div class="test-section">
            <h3>ğŸ“Š æ—¥èªŒè¼¸å‡º</h3>
            <div id="logOutput" class="log-output">
                <div class="log-entry">ç­‰å¾…æ—¥èªŒäº‹ä»¶...</div>
            </div>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ‘ï¸ åœ–åƒæ•ç²æ—¥èªŒæ¸¬è©¦</h3>
            <p>æ¨¡æ“¬åœ–åƒæ•ç²äº‹ä»¶</p>
            <select id="testDevice">
                <option value="ğŸ“± iPhone Camera">ğŸ“± iPhone Camera</option>
                <option value="ğŸ’» MacBook FaceTime HD Camera">ğŸ’» MacBook FaceTime HD Camera</option>
                <option value="ğŸ¥ USB Camera">ğŸ¥ USB Camera</option>
            </select>
            <input type="range" id="testQuality" min="0.5" max="1.0" step="0.1" value="0.9">
            <span id="qualityValue">0.9</span>
            <br>
            <button onclick="testEyesCapture()">æ¸¬è©¦åœ–åƒæ•ç²æ—¥èªŒ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ’¬ è¦–è¦ºæç¤ºè©æ—¥èªŒæ¸¬è©¦</h3>
            <p>æ¨¡æ“¬è¦–è¦ºæç¤ºè©è¨˜éŒ„</p>
            <input type="text" id="testPrompt" placeholder="è¼¸å…¥æ¸¬è©¦æç¤ºè©..." value="What do you see in this image?">
            <button onclick="testEyesPrompt()">æ¸¬è©¦æç¤ºè©æ—¥èªŒ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“¤ å¾Œç«¯å‚³è¼¸æ—¥èªŒæ¸¬è©¦</h3>
            <p>æ¨¡æ“¬å¾Œç«¯å‚³è¼¸è¨˜éŒ„</p>
            <input type="number" id="testTokens" placeholder="Max Tokens" value="100">
            <button onclick="testEyesTransfer()">æ¸¬è©¦å‚³è¼¸æ—¥èªŒ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ‘¤ ç”¨æˆ¶æ“ä½œæ—¥èªŒæ¸¬è©¦</h3>
            <p>æ¨¡æ“¬ç”¨æˆ¶æ“ä½œè¨˜éŒ„</p>
            <button onclick="testUserAction('start_processing')">é–‹å§‹è™•ç†</button>
            <button onclick="testUserAction('stop_processing')">åœæ­¢è™•ç†</button>
            <button onclick="testUserAction('camera_change')">åˆ‡æ›æ”åƒé ­</button>
            <button onclick="testUserAction('settings_change')">è®Šæ›´è¨­ç½®</button>
        </div>
        
        <div class="test-section">
            <h3>âŒ éŒ¯èª¤æ—¥èªŒæ¸¬è©¦</h3>
            <p>æ¨¡æ“¬éŒ¯èª¤è¨˜éŒ„</p>
            <button onclick="testError('camera_error')">æ”åƒé ­éŒ¯èª¤</button>
            <button onclick="testError('network_error')">ç¶²è·¯éŒ¯èª¤</button>
            <button onclick="testError('processing_error')">è™•ç†éŒ¯èª¤</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”„ å®Œæ•´æµç¨‹æ¸¬è©¦</h3>
            <p>æ¨¡æ“¬å®Œæ•´çš„è¦–è¦ºè™•ç†æµç¨‹</p>
            <button onclick="testCompleteFlow()">åŸ·è¡Œå®Œæ•´æµç¨‹æ¸¬è©¦</button>
        </div>
    </div>

    <script>
        // å‰ç«¯è¦–è¦ºæ—¥èªŒè¨˜éŒ„å™¨ï¼ˆç°¡åŒ–ç‰ˆæœ¬ç”¨æ–¼æ¸¬è©¦ï¼‰
        class FrontendVisualLogger {
            constructor() {
                this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                this.logToConsole = true;
                this.observationId = null;
            }
            
            generateObservationId() {
                const timestamp = Date.now();
                this.observationId = `obs_${timestamp}_${Math.random().toString(36).substr(2, 8)}`;
                return this.observationId;
            }
            
            log(eventType, data) {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    sessionId: this.sessionId,
                    eventType: eventType,
                    data: data
                };
                
                if (this.logToConsole) {
                    console.log(`[FrontendVisualLog] ${eventType}:`, data);
                }
                
                // é¡¯ç¤ºåœ¨é é¢ä¸Š
                this.displayLog(eventType, logEntry);
            }
            
            displayLog(eventType, logEntry) {
                const logOutput = document.getElementById('logOutput');
                const logDiv = document.createElement('div');
                logDiv.className = `log-entry log-${eventType.toLowerCase().replace('_', '-')}`;
                
                const timeStr = new Date(logEntry.timestamp).toLocaleTimeString();
                logDiv.innerHTML = `
                    <strong>[${timeStr}] ${eventType}:</strong> 
                    ${JSON.stringify(logEntry.data, null, 2)}
                `;
                
                logOutput.appendChild(logDiv);
                logOutput.scrollTop = logOutput.scrollHeight;
            }
            
            logEyesCapture(observationId, requestId, deviceInfo, imageData) {
                this.log('EYES_CAPTURE', {
                    observation_id: observationId,
                    request_id: requestId,
                    device: deviceInfo.device,
                    resolution: imageData.resolution,
                    quality: imageData.quality,
                    format: imageData.format,
                    size: imageData.size,
                    timestamp: Date.now()
                });
            }
            
            logEyesPrompt(observationId, prompt) {
                this.log('EYES_PROMPT', {
                    observation_id: observationId,
                    prompt: prompt,
                    length: prompt.length,
                    timestamp: Date.now()
                });
            }
            
            logEyesTransfer(observationId, transferData) {
                this.log('EYES_TRANSFER', {
                    observation_id: observationId,
                    sent_to_backend: transferData,
                    timestamp: Date.now()
                });
            }
            
            logUserAction(action, details) {
                this.log('USER_ACTION', {
                    action: action,
                    details: details,
                    timestamp: Date.now()
                });
            }
            
            logError(error, context) {
                this.log('FRONTEND_ERROR', {
                    error: error.toString(),
                    context: context,
                    stack: error.stack,
                    timestamp: Date.now()
                });
            }
        }
        
        // åˆå§‹åŒ–æ—¥èªŒè¨˜éŒ„å™¨
        const frontendLogger = new FrontendVisualLogger();
        
        // æ›´æ–°å“è³ªé¡¯ç¤º
        document.getElementById('testQuality').addEventListener('input', function() {
            document.getElementById('qualityValue').textContent = this.value;
        });
        
        // æ¸¬è©¦å‡½æ•¸
        function testEyesCapture() {
            const observationId = frontendLogger.generateObservationId();
            const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`;
            const device = document.getElementById('testDevice').value;
            const quality = parseFloat(document.getElementById('testQuality').value);
            
            const deviceInfo = { device: device };
            const imageData = {
                resolution: '1024x768',
                quality: quality,
                format: 'jpeg',
                size: '156.7KB'
            };
            
            frontendLogger.logEyesCapture(observationId, requestId, deviceInfo, imageData);
        }
        
        function testEyesPrompt() {
            const observationId = frontendLogger.observationId || frontendLogger.generateObservationId();
            const prompt = document.getElementById('testPrompt').value || 'What do you see in this image?';
            
            frontendLogger.logEyesPrompt(observationId, prompt);
        }
        
        function testEyesTransfer() {
            const observationId = frontendLogger.observationId || frontendLogger.generateObservationId();
            const maxTokens = parseInt(document.getElementById('testTokens').value) || 100;
            
            const transferData = {
                instruction: document.getElementById('testPrompt').value || 'What do you see in this image?',
                image_data: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...[truncated]',
                max_tokens: maxTokens,
                quality: document.getElementById('testQuality').value,
                observation_id: observationId,
                request_id: `req_${Date.now()}`
            };
            
            frontendLogger.logEyesTransfer(observationId, transferData);
        }
        
        function testUserAction(action) {
            let details = {};
            
            switch(action) {
                case 'start_processing':
                    details = {
                        instruction: document.getElementById('testPrompt').value,
                        capture_interval: 2000,
                        quality: document.getElementById('testQuality').value,
                        max_tokens: document.getElementById('testTokens').value
                    };
                    break;
                case 'stop_processing':
                    details = { reason: 'user_initiated' };
                    break;
                case 'camera_change':
                    details = {
                        device_id: 'test_device_123',
                        device_name: document.getElementById('testDevice').value
                    };
                    break;
                case 'settings_change':
                    details = {
                        setting: 'quality',
                        old_value: '0.8',
                        new_value: document.getElementById('testQuality').value
                    };
                    break;
            }
            
            frontendLogger.logUserAction(action, details);
        }
        
        function testError(errorType) {
            let error, context;
            
            switch(errorType) {
                case 'camera_error':
                    error = new Error('Camera access denied');
                    context = 'camera_initialization';
                    break;
                case 'network_error':
                    error = new Error('Failed to connect to backend');
                    context = 'api_request';
                    break;
                case 'processing_error':
                    error = new Error('Image processing failed');
                    context = 'vlm_request';
                    break;
            }
            
            frontendLogger.logError(error, context);
        }
        
        function testCompleteFlow() {
            // æ¨¡æ“¬å®Œæ•´çš„è¦–è¦ºè™•ç†æµç¨‹
            setTimeout(() => {
                frontendLogger.logUserAction('start_processing', {
                    instruction: 'Analyze this image',
                    capture_interval: 2000,
                    quality: '0.9'
                });
            }, 100);
            
            setTimeout(() => {
                testEyesCapture();
            }, 200);
            
            setTimeout(() => {
                testEyesPrompt();
            }, 300);
            
            setTimeout(() => {
                testEyesTransfer();
            }, 400);
            
            setTimeout(() => {
                frontendLogger.logUserAction('stop_processing', {
                    reason: 'user_initiated'
                });
            }, 500);
        }
        
        function clearLogs() {
            const logOutput = document.getElementById('logOutput');
            logOutput.innerHTML = '<div class="log-entry">æ—¥èªŒå·²æ¸…é™¤ï¼Œç­‰å¾…æ–°çš„æ—¥èªŒäº‹ä»¶...</div>';
        }
        
        // é é¢è¼‰å…¥æ™‚è¨˜éŒ„
        window.addEventListener('load', () => {
            frontendLogger.log('PAGE_LOAD', {
                url: window.location.href,
                userAgent: navigator.userAgent,
                timestamp: Date.now()
            });
        });
        
        // è¨˜éŒ„æœªæ•ç²çš„éŒ¯èª¤
        window.addEventListener('error', (event) => {
            frontendLogger.logError(event.error, 'uncaught_error');
        });
    </script>
</body>
</html>