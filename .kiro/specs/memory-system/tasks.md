# AI Manual Assistant 記憶系統實施計劃

**系統架構**：雙循環記憶系統（潛意識循環 + 即時響應循環）  
**當前狀態**：基礎存儲已完成，需要重新設計為雙循環架構  
**檢查日期**：2025年7月25日  
**目標**：論文Demo展示，重點展示核心創新和工程實用性

## 階段1：RAG 知識寶典建設 **[3/4 完成]**

- [x] 1.1 設計豐富的任務知識數據格式
  - 創建包含任務描述、工具、完成指標的YAML格式
  - 設計視覺線索關鍵詞和安全注意事項結構
  - 實現任務知識的驗證和載入機制
  - 創建「煮一杯咖啡」完整任務數據（包含5-10個步驟）
  - _展示價值: 結構化知識表示_

- [x] 1.2 實現RAG向量搜索引擎
  - 建立基於ChromaDB的高速向量搜索
  - 實現語義相似度計算和排序
  - 創建MatchResult數據模型，包含完整步驟信息
  - 優化搜索性能，目標響應時間 < 10ms（Demo時確認）
  - _展示價值: 智能語義匹配_

- [x] 1.3 預計算語義向量優化
  - 系統啟動時預計算所有任務步驟的embeddings
  - 實現向量緩存和快速檢索機制
  - 創建向量更新和維護接口
  - 編寫向量搜索性能測試
  - _展示價值: 工程優化實用性_

- [ ] 1.4 RAG知識庫管理接口
  - 實現任務知識的CRUD操作
  - 創建知識庫統計和健康檢查
  - 添加新任務和步驟的動態載入
  - 編寫RAG功能完整測試套件
  - _展示價值: 系統可擴展性_

## 階段2：State Tracker 比對引擎 **[4/4 完成]**

- [x] 2.1 實現State Tracker核心系統
  - 創建State Tracker類，接收現有 `/v1/chat/completions` 的文字回傳
  - 在 `main.py` 現有端點中添加State Tracker調用（一行代碼）
  - 實現VLM文字的清理和標準化處理（處理亂碼、空輸出）
  - 實現與RAG知識庫的向量匹配功能
  - 創建狀態更新和記錄機制
  - _展示價值: 直接使用現有VLM輸出 + 智能狀態追蹤_

- [x] 2.2 實現智能匹配和容錯機制
  - 創建多層相似度閾值判斷（高/中/低信心度處理）
  - 實現狀態更新的保守策略（低信心度時保持當前狀態）
  - 添加連續低匹配度的檢測和處理機制
  - 實現狀態變化的日誌和追蹤
  - 創建VLM輸出異常時的跳過機制
  - _展示價值: 智能狀態推理 + VLM不穩定性容錯_

- [x] 2.3 實現滑動窗格記憶體管控
  - 創建固定大小的狀態記錄滑動窗格（存儲匹配結果，不存原始VLM文本）
  - 實現自動清理最舊記錄的機制
  - 添加VLM觀察失敗記錄的特殊處理（不佔用窗格空間）
  - 實現基於滑動窗格歷史的狀態一致性檢查
  - 優化記憶體使用，目標 < 1MB( Demo時確認)
  - 添加記憶體使用監控和統計
  - _展示價值: 記憶體效率管控 + 歷史模式分析_

- [x] 2.4 建立即時響應白板機制
  - 實現當前狀態的快速查詢接口
  - 創建預格式化的用戶回應模板
  - 實現毫秒級的狀態讀取，目標 < 20ms（Demo時確認）
  - 添加用戶查詢的智能解析和路由
  - _展示價值: 即時響應能力_

## 階段3：雙循環系統整合 **[0/3 完成]**

- [ ] 3.1 實現潛意識循環（持續狀態感知）
  - 創建VLM觀察→比對引擎→狀態更新的循環
  - 實現VLM失敗時的跳過和繼續機制（不中斷循環）
  - 添加連續VLM失敗的檢測和降級處理
  - 實現循環的持續運行和異常恢復
  - 添加循環性能監控和健康檢查（包含VLM成功率統計）
  - 確保用戶無感知的背景運行
  - _展示價值: 潛意識狀態追蹤 + 系統韌性_

- [ ] 3.2 實現即時響應循環（按需查詢）
  - 創建用戶查詢→狀態讀取→即時回應的循環
  - 實現多種查詢類型的智能處理
  - 添加查詢響應時間優化
  - 創建用戶友好的回應格式
  - _展示價值: 即時查詢響應_

- [ ] 3.3 建立系統協調和錯誤處理
  - 實現雙循環的協調和同步機制
  - 創建VLM異常的多層容錯處理（跳過→重試→降級→維持狀態）
  - 實現匹配失敗時的回退策略（使用歷史模式推斷）
  - 添加系統狀態一致性檢查（檢測異常狀態跳躍）
  - 實現優雅降級和恢復機制（VLM長期失效時的處理）
  - 添加VLM品質評估和自適應閾值調整
  - _展示價值: 系統穩定性 + 智能適應性_

## 階段4：性能優化和監控 **[0/3 完成]**

- [ ] 4.1 實現性能監控系統
  - 創建實時性能指標收集
  - 實現響應時間、記憶體使用的監控
  - 添加系統健康狀態的可視化
  - 創建性能基準測試套件
  - _展示價值: 工程監控能力_

- [ ] 4.2 優化系統響應性能
  - 優化向量搜索和狀態更新性能
  - 實現智能緩存和預計算機制
  - 添加並發處理和資源管理
  - 確保所有操作達到性能目標
  - _展示價值: 高性能工程實現_

- [ ] 4.3 實現自動記憶體管理
  - 創建記憶體使用的自動監控
  - 實現自適應清理和優化策略
  - 添加記憶體洩漏檢測和預防
  - 確保系統長期穩定運行
  - _展示價值: 自動化資源管理_

## 階段4.5：靜態圖片測試 **[0/2 完成]**

- [ ] 4.5.1 實現靜態圖片測試系統
  - 創建測試資料夾圖片讀取接口
  - 實現圖片順序載入和VLM分析功能
  - 建立測試圖片與預期步驟的對應關係
  - 創建測試結果的準確率統計和報告
  - _展示價值: 系統準確性驗證_

- [ ] 4.5.2 準備「煮一杯咖啡」測試圖片集
  - 收集或創建5-10張煮咖啡流程的測試圖片
  - 為每張圖片標註預期的任務步驟和狀態
  - 實現測試圖片的批量處理和結果比對
  - 建立測試失敗時的詳細錯誤分析
  - _展示價值: 測試數據準備和驗證_

## 階段5：Demo整合和展示 **[0/3 完成]**

- [ ] 5.1 創建Demo場景和腳本
  - 設計「煮一杯咖啡」完整Demo場景
  - 創建展示雙循環工作機制的腳本
  - 實現Demo的自動化運行和重置
  - 添加Demo異常處理和恢復
  - _展示價值: 完整功能演示_

- [ ] 5.2 實現Demo可視化界面
  - 創建系統狀態的實時可視化
  - 實現雙循環運行狀態的展示
  - 添加記憶體使用和性能的圖表
  - 創建用戶交互的簡潔界面
  - _展示價值: 直觀系統展示_

- [ ] 5.3 準備Demo演示材料
  - 創建Demo運行指南和說明
  - 準備系統架構和創新點的展示材料
  - 錄製Demo運行視頻和截圖
  - 編寫Demo的技術文檔和FAQ
  - _展示價值: 完整Demo包裝_

## 關鍵驗收標準

### 功能性指標
- **雙循環運行**：潛意識循環持續運行 > 1小時，即時響應成功率 > 95%
- **狀態追蹤準確性**：VLM觀察到任務步驟匹配準確率 > 85%
- **用戶查詢滿意度**：能正確回答「現在在哪步」、「下一步做什麼」等查詢

### 性能指標
- **響應時間**：用戶查詢響應 < 50ms，狀態更新 < 100ms，RAG搜索 < 10ms
- **記憶體使用**：系統總記憶體使用 < 50MB，滑動窗格 < 1MB
- **系統穩定性**：持續運行 > 24小時無崩潰，錯誤恢復率 > 99%
- **VLM容錯性**：VLM失敗率 < 30%時系統正常運行，連續失敗 > 10次時優雅降級

### Demo展示指標
- **場景完整性**：能完整演示「煮一杯咖啡」任務的狀態追蹤
- **創新點展示**：清晰展示雙循環架構、智能匹配、記憶體管控
- **工程實用性**：展示系統的性能優化、錯誤處理、資源管理
- **容錯能力展示**：演示VLM輸出異常時系統的穩定運行和恢復能力
- **測試驗證**：通過靜態圖片測試驗證系統準確性（5-10張煮咖啡流程圖片）

## 實施優先級

**高優先級（論文Demo必需）**：
- 階段1.1-1.2：RAG知識庫和向量搜索
- 階段2.1-2.2：VLM觀察器和比對引擎
- 階段3.1-3.2：雙循環系統實現
- 階段4.5.1-4.5.2：靜態圖片測試系統
- 階段5.1：Demo場景腳本

**中優先級（Demo增強）**：
- 階段2.3-2.4：滑動窗格和即時響應
- 階段4.1：性能監控
- 階段5.2：可視化界面

**低優先級（完善功能）**：
- 階段1.3-1.4：性能優化和管理接口
- 階段3.3：錯誤處理完善
- 階段4.2-4.3：深度性能優化
- 階段5.3：Demo材料準備

這個實施計劃專注於論文Demo的核心需求，確保能夠有效展示系統的創新點和工程實用性。