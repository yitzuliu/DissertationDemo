# 記憶系統架構設計記錄

## 📅 設計確認日期
2025年7月25日

## 🎯 最終架構設計

### 💡 核心設計理念

**系統定位：**
- VLM作為"眼睛"持續觀察環境
- 記憶系統作為"大腦"記錄觀察結果
- 雙軌並行：觀察記錄 + 查詢回應
- 現有前端保持測試功能，新增查詢界面

### 🏗️ 最終系統架構

#### 雙軌並行設計

**軌道1：持續觀察記錄系統**
```
現有前端界面(port 5500) → Backend → VLM → 記憶系統
↑                                              ↓
定時觀察(1-5秒間隔) ←←←←←←←←←←←←←←←←←←←← 自動記錄觀察結果
```

**軌道2：記憶查詢系統**
```
新查詢界面(新port) → Backend(/v1/query) → 記憶檢索 → 返回結果
```

#### 系統組件角色定義

1. **VLM模型**
   - 角色：系統的"眼睛"
   - 功能：持續觀察和理解環境狀況
   - 輸出：對當前環境的描述和分析

2. **記憶系統**
   - 角色：系統的"大腦"
   - 功能：存儲VLM的觀察結果
   - 內容：VLM看到什麼就記錄什麼，無特定分類

3. **現有前端界面 (port 5500)**
   - 角色：VLM測試平台
   - 功能：測試不同模型的回應品質
   - 用途：確認大腦會記錄哪些資料
   - 狀態：保持不變

4. **新查詢界面 (新port)**
   - 角色：記憶查詢工具
   - 功能：讓用戶查詢記憶中的信息
   - 特點：純文字界面，無攝像頭功能

### 🔧 技術實現要求

#### 後端API設計
- **`/v1/observe`** - 持續觀察和記錄（背景運行）
  - 接收圖像數據
  - 發送給VLM分析
  - 將分析結果存入記憶系統

- **`/v1/query`** - 查詢記憶（用戶觸發）
  - 接收用戶文字查詢
  - 從記憶中檢索相關信息
  - 返回最相關的觀察記錄

- **現有 `/v1/chat/completions`** - 保持原樣，用於模型測試

#### 觀察機制參數
- **觀察頻率**：1-5秒間隔（使用現有前端的頻率設定）
- **觀察觸發**：定時自動觀察
- **記憶內容**：VLM的完整觀察描述
- **存儲策略**：所有觀察結果都進入記憶系統

#### 前端設計要求
- **現有界面**：完全保持不變
- **新查詢界面**：
  - 獨立的新頁面（新port）
  - 簡單的文字輸入框
  - 顯示記憶檢索結果
  - 不需要攝像頭功能

### 🎨 用戶使用場景

#### 開發者測試場景
1. 打開現有界面 (port 5500) 測試VLM模型
2. 系統在背景自動觀察並記錄到記憶中
3. 打開新查詢界面 (新port) 詢問："剛才看到什麼？"
4. 系統從記憶中檢索相關觀察記錄回答

#### 最終用戶場景
1. 系統持續在背景觀察環境（無需用戶操作）
2. 用戶有疑問時打開查詢界面
3. 輸入問題："現在發生什麼事？"、"桌上有什麼工具？"
4. 獲得基於記憶的智能回答

### 🔄 系統工作流程

#### 觀察記錄流程
1. 定時器觸發（1-5秒間隔）
2. 捕獲當前攝像頭畫面
3. 發送圖像到VLM進行分析
4. VLM返回對當前狀況的描述
5. 將描述存入記憶系統
6. 循環重複

#### 查詢回應流程
1. 用戶在查詢界面輸入問題
2. 系統接收查詢請求
3. 在記憶系統中搜索相關記錄
4. 基於語義相似度排序結果
5. 返回最相關的觀察記錄
6. 在界面上顯示結果

### 📊 關鍵設計原則

1. **分離關注點**：觀察記錄與查詢回應完全分離
2. **持續性**：觀察是持續的背景任務
3. **按需查詢**：用戶查詢是按需觸發的
4. **保持現狀**：現有測試界面完全不變
5. **純記憶驅動**：查詢回應完全基於記憶檢索

### 🎯 成功標準

#### 功能標準
- [ ] VLM能夠持續觀察環境並生成描述
- [ ] 記憶系統能夠存儲和檢索觀察記錄
- [ ] 新查詢界面能夠接收用戶問題並返回相關記憶
- [ ] 現有測試界面功能完全不受影響

#### 用戶體驗標準
- [ ] 開發者可以通過測試界面確認記憶內容
- [ ] 用戶可以通過查詢界面了解環境狀況
- [ ] 系統回應基於實際觀察記錄，具有時間連續性
- [ ] 查詢結果相關性高，能夠回答用戶問題

### 📝 重要決策記錄

1. **架構決策**：採用雙軌並行設計，而非單一整合方案
2. **界面決策**：創建新查詢界面，保持現有測試界面不變
3. **觀察決策**：定時觀察而非事件觸發觀察
4. **記憶決策**：記錄所有觀察內容，不進行預先分類
5. **端口決策**：新查詢界面使用獨立端口

### 🔮 未來擴展考慮

1. **智能觀察**：從定時觀察升級為變化檢測觀察
2. **記憶分類**：對觀察記錄進行智能分類和標籤
3. **多模態查詢**：支持圖像+文字的複合查詢
4. **記憶摘要**：對長期記憶進行智能摘要和壓縮
5. **個性化**：根據用戶習慣調整記憶檢索策略

---

**文檔版本**：v1.0  
**最後更新**：2025年7月25日  
**狀態**：已確認，準備進入開發階段