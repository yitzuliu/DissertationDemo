# 🏗️ AI Manual Assistant 記憶系統架構總覽

## 📋 快速理解指南

**適用對象**：新加入的AI助理或開發者  
**目的**：快速理解專案架構和運作邏輯  
**更新日期**：2025年7月27日

## 🎯 專案目標

開發一個**分離式服務架構的雙循環記憶系統**，用於論文Demo展示，實現智能任務進度追蹤。

### 核心創新點
1. **雙循環架構**：潛意識狀態感知 + 即時查詢響應 ✅
2. **分離式服務設計**：三個獨立服務協同工作 ✅
3. **智能狀態匹配**：基於RAG向量搜索的任務進度識別 ✅
4. **記憶體管控**：滑動窗格固定記憶體使用 ✅
5. **查詢內容完整性**：詳細工具列表、步驟信息、進度查詢 ✅
6. **高精度查詢分類**：100%準確率的自然語言查詢理解 ✅

## 🏗️ 系統架構

### 分離式服務設計

```mermaid
graph TB
    subgraph "模型服務（獨立啟動）"
        A[VLM觀察器]
        A1[觀察間隔控制]
        A2[視覺數字化]
    end
    
    subgraph "後端服務（獨立啟動）"
        B[State Tracker]
        B1[RAG知識庫]
        B2[比對引擎]
        B3[白板狀態]
        B4[滑動窗格]
    end
    
    subgraph "前端服務（獨立啟動）"
        C[用戶界面]
        C1[查詢處理]
        C2[結果顯示]
    end
    
    A --> B : VLM文字
    C --> B : 用戶查詢
    B --> C : 狀態回應
```

### 三個獨立服務

#### 1. 模型服務
- **職責**：VLM持續觀察，視覺世界數字化
- **控制**：在前端index.html中設定觀察間隔（2/3/5秒可調）
- **輸出**：清理後的VLM觀察文字
- **特性**：獨立運行，不依賴其他服務

#### 2. 後端服務  
- **職責**：State Tracker + RAG處理，狀態管理
- **組件**：比對引擎、白板機制、滑動窗格、RAG知識庫
- **功能**：接收VLM文字 → 智能匹配 → 狀態更新 → 回應查詢
- **特性**：獨立運行，提供API端點

#### 3. 前端服務
- **職責**：用戶界面和交互處理
- **功能**：接收用戶查詢 → 調用後端API → 顯示結果
- **特性**：獨立運行，通過HTTP與後端通信

## 🔄 雙循環工作機制

### 第一循環：潛意識狀態感知（跨服務持續運行）
```
模型服務：VLM觀察（間隔2/3/5秒可調） → 
後端服務：接收文字 → RAG匹配 → 狀態更新 → 存入滑動窗格
```
- **特性**：用戶無感知背景運行
- **目的**：持續理解「我們現在進行到哪了」

### 第二循環：即時查詢響應（跨服務按需觸發）
```
前端服務：用戶查詢 → 
後端服務：讀取白板狀態 → 
前端服務：顯示結果（< 50ms）
```
- **特性**：毫秒級響應，無需重新計算
- **目的**：即時回答用戶「現在在哪步」、「下一步做什麼」

## 📡 服務間通信

### 通信路徑
1. **模型 → 後端**：VLM觀察文字傳輸
2. **前端 → 後端**：用戶查詢請求
3. **後端 → 前端**：狀態回應數據

### 驗證重點（階段3）✅ 已完成
- 各服務能獨立啟動 ✅
- 端口通信正常 ✅
- 數據流暢通 ✅
- **不需要整合為單一系統** ✅
- 查詢內容完整性驗證 ✅
- 高優先級問題修復 ✅

## 🎯 Demo場景

### 任務：「煮一杯咖啡」
- **模型服務**：持續觀察用戶煮咖啡動作
- **後端服務**：識別當前步驟（準備豆子 → 研磨 → 沖泡...）
- **前端服務**：回答用戶查詢「我現在在第幾步？」

### 測試驗證
- **靜態圖片測試**：5-10張煮咖啡流程圖片，驗證準確率 > 80%
- **容錯測試**：VLM輸出異常時系統穩定運行
- **性能測試**：響應時間 < 50ms，記憶體使用 < 50MB

## 📊 關鍵技術指標

### 性能目標
- **用戶查詢響應**：< 50ms
- **狀態更新延遲**：< 100ms  
- **RAG向量搜索**：< 10ms
- **記憶體使用**：< 50MB（滑動窗格 < 1MB）

### 準確性目標
- **狀態匹配準確率**：> 85%
- **靜態圖片測試**：> 80%
- **VLM容錯能力**：失敗率 < 30%時正常運行

## 🛠️ 當前狀態

### 已完成（階段1-2）
- ✅ RAG知識庫和向量搜索
- ✅ State Tracker核心系統
- ✅ 智能匹配和容錯機制
- ✅ 滑動窗格記憶體管控
- ✅ 即時響應白板機制

### 進行中（階段3）
- 🔄 服務間通信驗證
- 🔄 跨服務雙循環協調
- 🔄 跨服務基礎功能測試

### 待完成（階段4-5）
- ⏳ 靜態圖片測試系統
- ⏳ Demo場景和可視化界面

## 📁 重要文檔

### 核心設計文檔
- `design.md` - 詳細技術設計
- `requirements.md` - 系統需求
- `tasks.md` - 實施計劃和任務列表

### 討論記錄
- `discussion-record.md` - 架構決策記錄
- `READY_FOR_IMPLEMENTATION.md` - 實施準備狀態

### 當前重點
- **階段3**：服務通信驗證與基礎功能測試
- **目標**：確保三個服務間通信暢通，不需要整合為單一系統

## 🚀 快速上手

### 理解重點
1. **分離式架構**：三個獨立服務，不是單一整合系統
2. **雙循環機制**：跨服務的潛意識感知 + 即時響應
3. **通信驗證**：重點是服務間數據流暢通
4. **Demo導向**：所有開發都為論文Demo服務

### 開發原則
- 服務獨立：各服務可單獨啟動和測試
- 通信簡潔：通過標準HTTP API通信
- 性能優先：毫秒級響應，固定記憶體使用
- 容錯設計：VLM不穩定時系統仍能運行

---

**文檔版本**：v1.0  
**適用階段**：階段3（服務通信驗證）  
**下次更新**：階段3完成後